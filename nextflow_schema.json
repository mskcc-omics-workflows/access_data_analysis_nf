{
    "$schema": "https://json-schema.org/draft/2020-12/schema",
    "$id": "https://raw.githubusercontent.com/nf-core/accessanalysis/master/nextflow_schema.json",
    "title": "nf-core/accessanalysis pipeline parameters",
    "description": "MSK ACCESS Data Analysis Nextflow Pipeline",
    "type": "object",
    "$defs": {
        "input_output_options": {
            "title": "Input/output options",
            "type": "object",
            "fa_icon": "fas fa-terminal",
            "description": "Define where the pipeline should find input data and save output data.",
            "required": [
                "input",
                "outdir"
            ],
            "properties": {
                "input": {
                    "type": "string",
                    "format": "file-path",
                    "exists": true,
                    "schema": "assets/schema_input.json",
                    "mimetype": "text/csv",
                    "pattern": "^\\S+\\.csv$",
                    "description": "Path to comma-separated file containing the columns cmo_patient_id, dmp_patient_id, and sex.",
                    "help_text": "You will need to create an input file containing patient cmo id, dmp id, and sex to run this pipeline. Use this parameter to specify its location. It has to be a comma-separated file with 3 columns, and no header row.",
                    "fa_icon": "fas fa-file-csv"
                },
                "outdir": {
                    "type": "string",
                    "format": "directory-path",
                    "description": "The output directory where the results will be saved.",
                    "fa_icon": "fas fa-folder-open",
                    "default": "./results/"
                } 
            }
        },
        "generic_options": {
            "title": "Generic options",
            "type": "object",
            "fa_icon": "fas fa-file-import",
            "description": "Less common options for the pipeline, typically set in a config file.",
            "help_text": "These options are common to all nf-core pipelines and allow you to customise some of the core preferences for how the pipeline runs.\n\nTypically these options would be set in a Nextflow config file loaded for all pipeline runs, such as `~/.nextflow/config`.",
            "properties": {
                "version": {
                    "type": "boolean",
                    "description": "Display version and exit.",
                    "fa_icon": "fas fa-question-circle",
                    "hidden": true
                },
                "publish_dir_mode": {
                    "type": "string",
                    "default": "copy",
                    "description": "Method used to save pipeline results to output directory.",
                    "help_text": "The Nextflow `publishDir` option specifies which intermediate files should be saved to the output directory. This option tells the pipeline what method should be used to move these files. See [Nextflow docs](https://www.nextflow.io/docs/latest/process.html#publishdir) for details.",
                    "fa_icon": "fas fa-copy",
                    "enum": [
                        "symlink",
                        "rellink",
                        "link",
                        "copy",
                        "copyNoFollow",
                        "move"
                    ],
                    "hidden": true
                },
                "monochrome_logs": {
                    "type": "boolean",
                    "description": "Do not use coloured log outputs.",
                    "fa_icon": "fas fa-palette",
                    "hidden": true
                },
                "validate_params": {
                    "type": "boolean",
                    "description": "Boolean whether to validate parameters against the schema at runtime",
                    "default": true,
                    "fa_icon": "fas fa-check-square",
                    "hidden": true
                },
                "trace_report_suffix": {
                    "type": "string",
                    "fa_icon": "far calendar",
                    "description": "Suffix to add to the trace report filename. Default is the date and time in the format yyyy-MM-dd_HH-mm-ss.",
                    "hidden": true
                }
            }
        }
    },
    "allOf": [
        {
            "$ref": "#/$defs/input_output_options"
        },
        {
            "$ref": "#/$defs/generic_options"
        }
    ],
    "properties": {
        "keep_research_samples_file": {
            "type": ["string", "null"],
            "format": "file-path",
            "exists": true,
            "pattern": "\\.csv$",
            "description": "Optional path to a file listing research samples to limit analysis to.",
            "help_text": "If provided, this file should contain one sample ID per line corresponding to research samples that analysis will be limited to. If not provided (null), all available samples are considered."
        },
        "exclude_samples_file": {
            "type": ["string", "null"],
            "format": "file-path",
            "exists": true,
            "pattern": "\\.csv$",
            "description": "Optional path to a file listing samples to exclude from the analysis.",
            "help_text": "If provided, this file should contain one sample ID per line corresponding to samples that should be excluded. If not provided (null), no samples will be excluded."
        },
        "clinical_access_sample_regex_pattern": {
            "type": "string",
            "default": ".*-XS.*-standard.*"
        },
        "clinical_impact_sample_regex_pattern": {
            "type": "string",
            "default": ".*(-IM|-IH).*"
        },
        "fasta_ref": {
            "type": "string",
            "format":"file-path",
            "exists": true,
            "pattern": "\\.fasta$"
        },
        "hotspot_list": {
            "type": "string",
            "format":"file-path",
            "exists": true
        },
        "ch_list": {
            "type": "string",
            "format":"file-path",
            "exists": true
        },
        "base_dirs": {
            "type": "object",
            "description": "Base directory paths for various access modes",
            "properties": {
                "research_access": {
                "type": "object",
                "properties": {
                    "data_dir": {
                    "type": "string",
                    "format": "directory-path",
                    "exists": true,
                    "pattern": "^/.*",
                    "description": "Top-level data directory for research access"
                    },
                    "bam_dir_template": {
                    "type": "string",
                    "pattern": "^/.*\\{cmo_patient_id\\}.*\\{sample_id\\}.*",
                    "description": "Template for research BAM paths, must contain {cmo_patient_id} and {sample_id}"
                    }
                },
                "required": ["data_dir", "bam_dir_template"]
                },
                "clinical_access": {
                "type": "object",
                "properties": {
                    "bam_dir_template": {
                    "type": "string",
                    "pattern": "^/.*\\{anon_id_fl\\}.*\\{anon_id_sl\\}.*",
                    "description": "Template for clinical access BAMs"
                    },
                    "variant_dir": {
                    "type": "string",
                    "format": "directory-path",
                    "exists": true,
                    "pattern": "^/.*",
                    "description": "Variant directory for clinical access"
                    }
                },
                "required": ["bam_dir_template", "variant_dir"]
                },
                "clinical_impact": {
                "type": "object",
                "properties": {
                    "bam_dir_template": {
                    "type": "string",
                    "pattern": "^/.*\\{anon_id_fl\\}.*\\{anon_id_sl\\}.*",
                    "description": "Template for clinical impact BAMs"
                    },
                    "variant_dir": {
                    "type": "string",
                    "format": "directory-path",
                    "exists": true,
                    "description": "Variant directory for clinical impact"
                    },
                    "facets_dir": {
                    "type": "string",
                    "format": "directory-path",
                    "exists": true,
                    "description": "FACETS directory for clinical impact"
                    }
                },
                "required": ["bam_dir_template", "variant_dir", "facets_dir"]
                }
            },
            "required": ["research_access", "clinical_access", "clinical_impact"]
        },
        "biometrics": {
            "type": "object",
            "description": "Paths to biometrics resources used for ACCESS processing",
            "properties": {
                "bed": {
                "type": "string",
                "format": "file-path",
                "exists": true,
                "pattern": "^/.*\\.bed$",
                "description": "BED file containing regions of interest for biometrics",
                "errorMessage": "biometrics.bed must be an absolute path to an existing .bed file"
                },
                "vcf": {
                "type": "string",
                "format": "file-path",
                "exists": true,
                "pattern": "^/.*\\.vcf$",
                "description": "VCF file containing tiling and fingerprint SNPs for biometrics",
                "errorMessage": "biometrics.vcf must be an absolute path to an existing .vcf file"
                }
            },
            "required": ["bed", "vcf"]
        },
        "file_paths": {
            "type": "object",
            "description": "File path templates and resources for each access mode",
            "properties": {
                "research_access": {
                "type": "object",
                "description": "Templates and data locations for research access",
                "properties": {
                    "bam_file_template": {
                    "type": "object",
                    "properties": {
                        "simplex": {
                        "type": "string",
                        "pattern": "\\{sample_id\\}.*simplex\\.bam$",
                        "description": "Path template for research simplex BAMs"
                        },
                        "duplex": {
                        "type": "string",
                        "pattern": "\\{sample_id\\}.*duplex\\.bam$",
                        "description": "Path template for research duplex BAMs"
                        },
                        "unfilter": {
                        "type": "string",
                        "pattern": "\\{sample_id\\}.*\\.bam$",
                        "description": "Path template for research unfiltered BAMs"
                        },
                        "standard": {
                        "type": "string",
                        "pattern": "\\{sample_id\\}.*\\.bam$",
                        "description": "Path template for standard research BAMs"
                        }
                    },
                    "required": ["simplex", "duplex", "unfilter", "standard"]
                    },
                    "variant_file_template": {
                    "type": "object",
                    "properties": {
                        "mutations": {
                        "type": "string",
                        "pattern": "\\{sample_id\\}.*\\.maf$",
                        "description": "Template path for MAF mutation files"
                        },
                        "cna": {
                        "type": "string",
                        "pattern": "\\{sample_id\\}.*copynumber.*\\.txt$",
                        "description": "Template path for copy number variant files"
                        },
                        "sv": {
                        "type": "string",
                        "pattern": "\\{sample_id\\}.*SV.*\\.txt$",
                        "description": "Template path for structural variant files"
                        },
                        "msi": {
                        "type": "string",
                        "pattern": "msi_results\\.txt$",
                        "description": "Template path for MSI result files"
                        }
                    },
                    "required": ["mutations", "cna", "sv", "msi"]
                    }
                },
                "required": ["bam_file_template", "variant_file_template"]
                },

                "clinical_access": {
                "type": "object",
                "description": "Templates and resources for clinical access",
                "properties": {
                    "key_file": {
                    "type": "string",
                    "format": "file-path",
                    "exists": true,
                    "pattern": "^/.*key\\.txt$",
                    "description": "Key file for clinical access requests"
                    },
                    "bam_file_template": {
                    "type": "object",
                    "properties": {
                        "simplex": {
                        "type": "string",
                        "pattern": "\\{anon_id\\}.*simplex\\.bam$"
                        },
                        "duplex": {
                        "type": "string",
                        "pattern": "\\{anon_id\\}.*duplex\\.bam$"
                        },
                        "unfilter": {
                        "type": "string",
                        "pattern": "\\{anon_id\\}.*unfilter\\.bam$"
                        },
                        "standard": {
                        "type": "string",
                        "pattern": "\\{anon_id\\}.*standard\\.bam$"
                        }
                    },
                    "required": ["simplex", "duplex", "unfilter", "standard"]
                    },
                    "variant_file": {
                    "type": "object",
                    "properties": {
                        "mutations": {
                        "type": "string",
                        "format": "file-path",
                        "exists": true,
                        "pattern": "data_mutations_extended\\.txt$"
                        },
                        "cna": {
                        "type": "string",
                        "format": "file-path",
                        "exists": true,
                        "pattern": "data_CNA\\.txt$"
                        },
                        "sv": {
                        "type": "string",
                        "format": "file-path",
                        "exists": true,
                        "pattern": "data_sv\\.txt$"
                        },
                        "msi": {
                        "type": "string",
                        "format": "file-path",
                        "exists": true,
                        "pattern": "\\.csv$",
                        "description": "MSI results CSV file for clinical access"
                        }
                    },
                    "required": ["mutations", "cna", "sv", "msi"]
                    }
                },
                "required": ["key_file", "bam_file_template", "variant_file"]
                },

                "clinical_impact": {
                "type": "object",
                "description": "Templates and resources for clinical impact",
                "properties": {
                    "key_file": {
                    "type": "string",
                    "format": "file-path",
                    "exists": true,
                    "pattern": "^/.*key\\.txt$"
                    },
                    "bam_file_template": {
                    "type": "object",
                    "properties": {
                        "standard": {
                        "type": "string",
                        "pattern": "\\{anon_id\\}.*\\.bam$"
                        }
                    },
                    "required": ["standard"]
                    },
                    "variant_file": {
                    "type": "object",
                    "properties": {
                        "mutations": {
                        "type": "string",
                        "format": "file-path",
                        "exists": true,
                        "pattern": "data_mutations_extended\\.txt$"
                        },
                        "cna": {
                        "type": "string",
                        "format": "file-path",
                        "exists": true,
                        "pattern": "data_CNA\\.txt$"
                        },
                        "sv": {
                        "type": "string",
                        "format": "file-path",
                        "exists": true,
                        "pattern": "data_sv\\.txt$"
                        },
                        "msi": {
                        "type": "string",
                        "format": "file-path",
                        "exists": true,
                        "pattern": "data_clinical_sample\\.txt$"
                        }
                    },
                    "required": ["mutations", "cna", "sv", "msi"]
                    }
                },
                "required": ["key_file", "bam_file_template", "variant_file"]
                }
            },
            "required": ["research_access", "clinical_access", "clinical_impact"]
        },
        "variant_filter_rules": {
            "type": "object",
            "description": "Rules to filter variants during ACCESS analysis",
            "properties": {
                "exclude_genes": {
                "type": "string",
                "description": "Gene prefix or pattern to exclude from analysis"
                },
                "exclude_classifications": {
                "type": "string",
                "description": "Variant classifications to exclude (comma-separated)"
                },
                "access_min_cov": {
                "type": "integer",
                "minimum": 0,
                "description": "Minimum coverage required in ACCESS data"
                },
                "impact_min_cov": {
                "type": "integer",
                "minimum": 0,
                "description": "Minimum coverage required in clinical impact data"
                },
                "hotspot_cutoff": {
                "type": "integer",
                "minimum": 0,
                "description": "Minimum duplex reads required in at least one tumor sample for hotspot SNVs/Indels calls"
                },
                "non_hotspot_cutoff": {
                "type": "integer",
                "minimum": 0,
                "description": "Minimum duplex reads required in at least one tumor sample for non-hotspot SNVs/Indels calls"
                },
                "vaf_ratio_threshold": {
                "type": "number",
                "minimum": 0,
                "description": "Minimum ratio threshold for max VAF of tumor to max VAF of normal for non-signed out SNVs/Indels"
                }
            },
            "required": [
                "exclude_genes",
                "exclude_classifications",
                "access_min_cov",
                "impact_min_cov",
                "hotspot_cutoff",
                "non_hotspot_cutoff",
                "vaf_ratio_threshold"
            ]
            },
        "access_copy_number_gene_list": {
            "type": "string",
            "default": "AR,BRCA1,BRCA2,CDK4,EGFR,ERBB2,MET,MDM2,MLH1,MSH2,MSH6,MYC"
        },
        "copy_number_p_value_threshold": {
            "type": "number",
            "default": 0.05
        },
        "access_structural_variant_gene_list": {
            "type": "string",
            "default": "ALK,BRAF,ERBB2,EGFR,FGFR1,FGFR2,FGFR3,KIT,MET,NTRK1,NTRK2,NTRK3,PDGFRA,RET,ROS1"
        }
    }
}
